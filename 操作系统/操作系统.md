## 1、操作系统概述

![title](https://raw.githubusercontent.com/XQLong/Logging/master/img/2019/08/02/1564718862757-1564718862957.png)

### 作为系统资源的管理者

提供的功能：
- 文件管理
- 存储器管理
- 处理机管理
- 设备管理

目标：安全、高效

### 作为用户和计算机硬件之间的接口

- **命令接口**（联机、脱机）
- **程序接口**（由系统调用组成）
- GUI

![title](https://raw.githubusercontent.com/XQLong/Logging/master/img/2019/08/02/1564719180677-1564719180684.png)

### 实现对硬件机器的拓展

扩充机器。

## 2、操作系统基本特征

![title](https://raw.githubusercontent.com/XQLong/Logging/master/img/2019/08/02/1564719572447-1564719572453.png)

### 并发

并发是指两个或多个事件在同一时间间隔发生。（区分并发和并行）

### 共享

共享即资源共享，是指系统中的资源可供内存中多个并发的进程共同使用。

![title](https://raw.githubusercontent.com/XQLong/Logging/master/img/2019/08/02/1564719783117-1564719783123.png)

并发和共享互为存在条件。

### 虚拟

把物理上的实体变为若干个逻辑上的对应物。物理实体是实际存在的，而逻辑上对应物是用户感受到的。

![title](https://raw.githubusercontent.com/XQLong/Logging/master/img/2019/08/02/1564728101232-1564728101238.png)

### 异步

异步是指多道程序环境下，允许多个程序并发执行。但由于资源有限，进程的执行不一定是一贯到底的，而是走走停停，以不可预知的速度向前推进，者就是进程的异步性。

特点总结：并发和共享是操作系统最基本的两个特征，两者互为存在条件。没有并发和共享，就谈不上虚拟和异步。

## 操作系统的分类和发展

![title](https://raw.githubusercontent.com/XQLong/Logging/master/img/2019/08/02/1564729193413-1564729193418.png)

## 3、操作系统运行环境

- 两种指令：

指令就是处理器（CPU）能够识别、执行的最基本命令。

![title](https://raw.githubusercontent.com/XQLong/Logging/master/img/2019/08/02/1564729368721-1564729368727.png)

- 两种处理器状态

![title](https://raw.githubusercontent.com/XQLong/Logging/master/img/2019/08/02/1564729437634-1564729437638.png)

- 两种程序

![title](https://raw.githubusercontent.com/XQLong/Logging/master/img/2019/08/02/1564729523951-1564729523955.png)

- 操作系统内核

![title](https://raw.githubusercontent.com/XQLong/Logging/master/img/2019/08/02/1564729731675-1564729731680.png)

- 操作系统的体系结构

![title](https://raw.githubusercontent.com/XQLong/Logging/master/img/2019/08/02/1564730005155-1564730005159.png)

## 4、中断

### 中断基本概念

引入中断机制，实现多道程序并发执行。发生中断就意味着需要操作系统介入，开展管理工作。

中断是操作系统从“用户态”转换为“核心态”的唯一途径；从核心态转换为用户态是通过执行一个特权指令，将程序状态字（PSW）的标志位设置为“用户态”。

### 中断的分类

![title](https://raw.githubusercontent.com/XQLong/Logging/master/img/2019/08/02/1564731039640-1564731039645.png)

## 5、进程

### 进程的定义

进程实体：PCB（程序控制块）、程序段、数据段三部分构成。一般情况下把进程实体就简称为进程。

进程是进程实体的运行过程，是系统进行资源分配和调度的一个独立单位。

### 进程的组成

![title](https://raw.githubusercontent.com/XQLong/Logging/master/img/2019/08/02/1564732793369-1564732793374.png)

### 进程的组织

如何使用合适的方法将多个进程组织起来？

![title](https://raw.githubusercontent.com/XQLong/Logging/master/img/2019/08/02/1564733077962-1564733077966.png)

### 进程的特征

![title](https://raw.githubusercontent.com/XQLong/Logging/master/img/2019/08/02/1564733163021-1564733163028.png)

### 进程的状态

三种基本状态：运行态、就绪态、阻塞态。

![title](https://raw.githubusercontent.com/XQLong/Logging/master/img/2019/08/02/1564733737201-1564733737206.png)

另外两种状态：

![title](https://raw.githubusercontent.com/XQLong/Logging/master/img/2019/08/02/1564733839881-1564733839887.png)

### 进程控制

简单理解就是实现进程状态之间的转换。

![title](https://raw.githubusercontent.com/XQLong/Logging/master/img/2019/08/04/1564914762137-1564914762141.png)

用原语实现进程控制，原语的特点是执行过程中不允许中断。

### 进程通信

进程通信指的就是进程之间的信息交换。

进程是分配系统资源的单位，因此各进程拥有的内存地址空间相互独立。为保证安全，一个进程不能直接访问另一个进程的地址空间。

- 共享存储：基于数据结构的共享（低级通信方式）；基于存储区的共享（高级）。
- 管道通信：管道只能采用半双工；各进程要互斥访问管道；管道写满时，不能再写，读空时，不能再读；没写满，不能读，没读空，不能写。
- 消息传递：进程间的数据交换以格式化的消息为单位。

## 5、线程

线程可以理解为“轻量级的进程”，它是基本的CPU执行单元，也是程序执行流的最小单元。

### 线程的实现方式

- 用户级线程
- 内核级线程，内核级线程是才是处理机分配的单位。

### 多线程模型

- 多对一模型
- 一对一模型
- 多对多模型

## 6、处理机调度

处理机调度，就是从就绪队列中按照一定的算法选择一个进程并将处理机分配给它运行，以实现进程的并发执行。

### 调度的三个层次

- 高级调度（作业调度）
- 中级调度（内存调度）
- 低级调度（进程调度）

### 进程调度的时机

进程调度（低级调度），就是按照某种算法从就绪队列中选择一个进程为其分配处理机。

### 调度算法评价指标

- CPU利用率
- 系统吞吐量
- 周转时间
- 平均周转时间
- 带权周转时间
- 等待时间
- 响应时间

### 调度算法

- 先来先服务（FCFS）
- 短作业优先算法（SJF）
- 高响应比优先（HRRN
- 时间片轮转调度算法（RR）
- 优先级调度算法
- 多级反馈队列调度算法

## 8、进程同步和互斥

### 进程同步

进程同步亦称直接制约关系，它是指为完成每种任务而建立的两个或多个进程，这些进程因为需要在某些位置上协调它们的工作次序而产生制约关系。进程间的直接制约关系就是源于它们之间的相互合作。

### 进程互斥

对临界资源的访问，需要互斥的进行。即同一时间段内只能允许一个进程访问该资源。

为实现对临界资源的互斥访问，同时保证系统整体性能，需要遵守以下性能：空闲让进；忙则等待；有限等待；让权等待。

### 进程互斥的软件实现

- 单标法：违背空闲让进原则； 
- 双标志先检查法：违反了忙则等待的原则；
- 双标志后检查法：违背了空闲让进和有限等待原则；
- Peterson算法

### 进程互斥的硬件实现

- 中断屏蔽方法：简单、高效；不适用多处理机，只适用于操作系统内核进程，不适用于用户进程；
- TestAndSet指令（TestAndSetLock、TSL）：不满足“让权等待”原则；
- Swap指令

### 信号量机制

信号量就是一个变量（可以是一个整数，也可以是更复杂的记录型变量），可以用一个信号量来表示系统中某种资源的数量。

![title](https://raw.githubusercontent.com/XQLong/Logging/master/img/2019/08/04/1564903316878-1564903316915.png)

- 整型信号量（不满足让权等待原则）

用一个整型变量作为信号量，用来表示系统中某种资源的数量。

- 记录型信号量

![title](https://raw.githubusercontent.com/XQLong/Logging/master/img/2019/08/04/1564904876319-1564904876324.png)

##死锁及处理策略

### 死锁

死锁：各个进程互相等待对方手里的资源，导致各进程都阻塞，无法向前推进的现象。
饥饿：由于长期得不到想要的资源，某进程无法向前推进的现象；
死循环：某进程执行过程中一直跳不出某个循环的现象。

### 安全序列

所谓安全序列，就是指如果系统按照这种序列分配资源，则每个进程都能顺利完成。只要能找出一个安全序列，系统就是安全状态。

如果系统处于安全状态，就一定不会发生死锁。如果系统进入不安全状态，就可能发生死锁。

银行家算法：

![title](https://raw.githubusercontent.com/XQLong/Logging/master/img/2019/08/05/1564974825739-1564974825912.png)

### 死锁的检测和解决

![title](https://raw.githubusercontent.com/XQLong/Logging/master/img/2019/08/05/1564975474495-1564975474495.png)

